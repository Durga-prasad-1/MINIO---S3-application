<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Subtree Counter</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        textarea { width: 100%; height: 100px; margin-bottom: 10px; }
        table { border-collapse: collapse; margin-bottom: 20px; }
        td, th { border: 1px solid #ccc; padding: 5px 10px; text-align: center; }
        .section { margin-top: 30px; }
    </style>
</head>
<body>
    <h1>Subtree Counter with DP Visualization</h1>

    <label>Number of Nodes (N):</label><br>
    <input type="number" id="N" value="5"><br><br>

    <label>Size of Subtree to Count (K):</label><br>
    <input type="number" id="K" value="3"><br><br>

    <label>Tree Edges (one per line, format: u v):</label><br>
    <textarea id="edges">1 2
1 3
3 4
3 5</textarea><br>

    <button onclick="run()">Run</button>

    <div class="section" id="fTableSection"></div>
    <div class="section" id="dpTablesSection"></div>

    <script>
        let N, K, tree, f, MOD = 1000000007;

        function run() {
            // Input
            N = parseInt(document.getElementById("N").value);
            K = parseInt(document.getElementById("K").value);
            const edgeLines = document.getElementById("edges").value.trim().split('\n');

            // Init
            tree = Array.from({ length: N + 1 }, () => []);
            f = Array.from({ length: N + 1 }, () => Array(K + 1).fill(0));

            // Parse edges
            for (let line of edgeLines) {
                const [u, v] = line.trim().split(/\s+/).map(Number);
                tree[u].push(v);
                tree[v].push(u);
            }

            const dpLogs = {};  // Save dp[][] per node

            dfs(1, 0, dpLogs);

            displayFTable();
            displayDPTables(dpLogs);
        }

        function dfs(v, parent, dpLogs) {
    f[v][1] = 1;

    const childDPs = [];

    for (let u of tree[v]) {
        if (u === parent) continue;
        dfs(u, v, dpLogs);
        childDPs.push([...f[u]]);
    }

    const m = childDPs.length;
    const dp = Array.from({ length: m + 1 }, () => Array(K + 1).fill(0));
    dp[0][0] = 1;

    for (let i = 1; i <= m; i++) {
        const childF = childDPs[i - 1];
        for (let j = 0; j <= K; j++) {
            for (let k = 0; k <= j; k++) {
                dp[i][j] = (dp[i][j] + dp[i - 1][j - k] * childF[k]) % MOD;
            }
        }
    }

    dpLogs[v] = dp;

    for (let k = 2; k <= K; k++) {
        f[v][k] = dp[m][k - 1];
    }

    // Debug output for each node after computing f[v]
    appendDebug(`After DFS at node ${v}: f[${v}] = [${f[v].slice(1, K+1).join(', ')}]`);
    appendDebug(`dp table for node ${v}:`);
    appendDebug(renderDPTable(dp));
}

function appendDebug(textOrElement) {
    const debugSection = document.getElementById("debugSection");
    if (!debugSection) {
        const div = document.createElement("div");
        div.id = "debugSection";
        div.style.whiteSpace = "pre";
        div.style.backgroundColor = "#f9f9f9";
        div.style.border = "1px solid #ccc";
        div.style.padding = "10px";
        div.style.marginTop = "20px";
        div.style.maxHeight = "300px";
        div.style.overflowY = "auto";
        document.body.appendChild(div);
    }
    const debugDiv = document.getElementById("debugSection");
    if (typeof textOrElement === "string") {
        debugDiv.appendChild(document.createTextNode(textOrElement + "\n"));
    } else {
        debugDiv.appendChild(textOrElement);
    }
}

function renderDPTable(dp) {
    const table = document.createElement("table");
    table.style.borderCollapse = "collapse";
    table.style.marginBottom = "15px";

    // header row
    const header = document.createElement("tr");
    header.appendChild(document.createElement("th")).textContent = "i \\ j";
    for (let j = 0; j < dp[0].length; j++) {
        const th = document.createElement("th");
        th.textContent = j;
        th.style.border = "1px solid #ccc";
        th.style.padding = "3px 6px";
        header.appendChild(th);
    }
    table.appendChild(header);

    for (let i = 0; i < dp.length; i++) {
        const row = document.createElement("tr");
        const th = document.createElement("th");
        th.textContent = i;
        th.style.border = "1px solid #ccc";
        th.style.padding = "3px 6px";
        row.appendChild(th);

        for (let j = 0; j < dp[i].length; j++) {
            const td = document.createElement("td");
            td.textContent = dp[i][j];
            td.style.border = "1px solid #ccc";
            td.style.padding = "3px 6px";
            row.appendChild(td);
        }
        table.appendChild(row);
    }
    return table;
}


        function displayFTable() {
            const section = document.getElementById("fTableSection");
            section.innerHTML = "<h2>f[v][k] Table</h2>";

            let html = '<table><tr><th>v \\ k</th>';
            for (let k = 1; k <= K; k++) html += `<th>${k}</th>`;
            html += '</tr>';

            for (let v = 1; v <= N; v++) {
                html += `<tr><td>${v}</td>`;
                for (let k = 1; k <= K; k++) {
                    html += `<td>${f[v][k]}</td>`;
                }
                html += '</tr>';
            }

            html += '</table>';
            section.innerHTML += html;
        }

        function displayDPTables(dpLogs) {
            const section = document.getElementById("dpTablesSection");
            section.innerHTML = "<h2>Intermediate dp[][] Tables in DFS</h2>";

            for (let v in dpLogs) {
                const dp = dpLogs[v];
                section.innerHTML += `<h3>Node ${v}</h3>`;
                let html = '<table><tr><th>i \\ j</th>';
                for (let j = 0; j <= K; j++) html += `<th>${j}</th>`;
                html += '</tr>';

                for (let i = 0; i < dp.length; i++) {
                    html += `<tr><td>${i}</td>`;
                    for (let j = 0; j <= K; j++) {
                        html += `<td>${dp[i][j]}</td>`;
                    }
                    html += '</tr>';
                }

                html += '</table>';
                section.innerHTML += html;
            }
        }
    </script>
</body>
</html>
